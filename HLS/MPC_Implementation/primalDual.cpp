#include "primalDual.hpp"
#include "hls_linear_algebra.h"

using namespace std;

void PrimalDual (fp curr_ref_0, fp curr_ref_1,
		fp x_obs_0,
		fp x_obs_1,
		fp x_obs_2,
		fp x_obs_3,
		fp x_obs_4,
		fp x_obs_5,
		fp& u_1, fp& u_2)
{



	/* Array Instantiation and Pre-Processing */
	std::cout << "Reference 1 " << curr_ref_0 << "\n";
	std::cout << "Reference 2 " << curr_ref_1 << "\n";

	fp v_to_cm = 7.15;

	fp curr_ref_arr[2][1] = {{curr_ref_0*v_to_cm},{curr_ref_1*v_to_cm}};
	fp observed_states[4][1] = { { x_obs_0}, { x_obs_1}, { x_obs_2} , { x_obs_3} } ;

	fp d_t [2][1] = {{x_obs_4}, {x_obs_5}};

	fp buffer_1 [2][1] = {{0},{0}};


	 fp f[30][1] =
	{
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0}
	};


	 fp z[30][1] =
	{
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0}
	};
#pragma HLS array_partition variable=z block factor = 5


fp lambda[20][1] =
	{
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0}
	};

#pragma HLS array_partition variable=lambda block factor = 4

	 fp e [20][1] =
	{
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0},
			{0}
	};


	static fp q_[30][2] =
	{
			{1.434483,-6.819522e-01},
			{-0.806897,1.212360e+00},
			{0.166000,0},
			{0.000000,1.660000e-01},
			{-0.039244,5.896385e-02},
			{0.037590,-1.787043e-02},
			{1.434483,-6.819522e-01},
			{-0.806897,1.212360e+00},
			{0.166000,0},
			{0.000000,1.660000e-01},
			{-0.039244,5.896385e-02},
			{0.037590,-1.787043e-02},
			{1.434483,-6.819522e-01},
			{-0.806897,1.212360e+00},
			{0.166000,0},
			{0.000000,1.660000e-01},
			{-0.039244,5.896385e-02},
			{0.037590,-1.787043e-02},
			{1.434483,-6.819522e-01},
			{-0.806897,1.212360e+00},
			{0.166000,0},
			{0.000000,1.660000e-01},
			{-0.039244,5.896385e-02},
			{0.037590,-1.787043e-02},
			{1.434483,-6.819522e-01},
			{-0.806897,1.212360e+00},
			{0.259005,3.072425e-02},
			{0.028507,2.937675e-01},
			{0.030439,1.026133e-01},
			{0.069129,1.122176e-01}

	};

	static fp H [30][30] =
	{
			{10.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,10.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,10.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,10.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,10.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,10.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,10.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,10.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,10.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,10.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,1.736217,-0.061816,0.672347,-7.507173e-02},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.061816,1.902831,-0.091103,9.362267e-01},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.672347,-0.091103,1.963610,-1.093598e-01},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.075072,0.936227,-0.109360,2.056343e+00}



	};
	static fp E [20][30] =
	{
			{-0.560350,-0.102659,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{-0.160672,-0.576956,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{-0.000000,-0.264972,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{-0.201236,-0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,-0.668987,-0.000000,-0.437001,-0.000000,-0.560350,-0.102659,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,-0.000000,-0.711952,-0.000000,-0.625329,-0.160672,-0.576956,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,-0.000000,-0.000000,-0.455189,-0.000000,-0.000000,-0.264972,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,-0.000000,-0.000000,-0.000000,-0.232065,-0.201236,-0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.668987,-0.000000,-0.437001,-0.000000,-0.560350,-0.102659,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,-0.711952,-0.000000,-0.625329,-0.160672,-0.576956,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,-0.000000,-0.455189,-0.000000,-0.000000,-0.264972,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,-0.000000,-0.000000,-0.232065,-0.201236,-0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.668987,-0.000000,-0.437001,-0.000000,-0.560350,-0.102659,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,-0.711952,-0.000000,-0.625329,-0.160672,-0.576956,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,-0.000000,-0.455189,-0.000000,-0.000000,-0.264972,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,-0.000000,-0.000000,-0.232065,-0.201236,-0.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.668987,-0.000000,-0.437001,-0.000000,-0.560350,-0.102659,1.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,-0.711952,-0.000000,-0.625329,-0.160672,-0.576956,0.000000,1.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,-0.000000,-0.455189,-0.000000,-0.000000,-0.264972,0.000000,0.000000,1.000000,0},
			{0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,0.000000,-0.000000,-0.000000,-0.000000,-0.232065,-0.201236,-0.000000,0.000000,0.000000,0.000000,1}
	};

	static fp F1[20][4] =
	{
			{0.668987,0.000000,0.437001,0},
			{0.000000,0.711952,0.000000,6.253288e-01},
			{0.000000,0.000000,0.455189,0},
			{0.000000,0.000000,0.000000,2.320652e-01},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0},
			{0.000000,0.000000,0.000000,0}
	};

	static fp z_min[30][1] =
	{
			{0},
			{0},
			{-15},
			{-15},
			{-15},
			{-15},
			{0},
			{0},
			{-15},
			{-15},
			{-15},
			{-15},
			{0},
			{0},
			{-15},
			{-15},
			{-15},
			{-15},
			{0},
			{0},
			{-15},
			{-15},
			{-15},
			{-15},
			{0},
			{0},
			{-15},
			{-15},
			{-15},
			{-15}
	};

	static fp z_max[30][1] =
	{
			{3},
			{3},
			{15},
			{15},
			{15},
			{15},
			{3},
			{3},
			{15},
			{15},
			{15},
			{15},
			{3},
			{3},
			{15},
			{15},
			{15},
			{15},
			{3},
			{3},
			{15},
			{15},
			{15},
			{15},
			{3},
			{3},
			{15},
			{15},
			{15},
			{15}
	};

	/* Pre Primal-Dual Computation */

	buffer_1[0][0] = curr_ref_arr[0][0] - d_t[0][0];
	buffer_1[1][0] = curr_ref_arr[1][0] - d_t[1][0];
/*
	struct MY_CONFIG: hls::matrix_multiply_traits<hls::NoTranspose,
	 hls::NoTranspose,
	 30,
	 2,
	 2,
	 1,
	 fp,
	 fp>{
	 static const int ARCH = 0;
	 static const int INNER_II = 5;
	 static const int UNROLL_FACTOR = 1;
	};

	struct MY_CONFIG_2: hls::matrix_multiply_traits<hls::NoTranspose,
	 hls::NoTranspose,
	 20,
	 4,
	 4,
	 1,
	 fp,
	 fp>{
	 static const int ARCH = 0;
	 static const int INNER_II = 5;
	 static const int UNROLL_FACTOR = 1;
	};
*/

	//Compute f = q_ * (curr_ref - d_t)
	hls::matrix_multiply<hls::NoTranspose, hls::NoTranspose,30,2,2,1,30,1>(q_,buffer_1,f);


	//Compute e = F1 * observed states
	hls::matrix_multiply<hls::NoTranspose, hls::NoTranspose,20,4,4,1,20,1>(F1,observed_states,e);


	/*Primal Dual Algorithm */

	//Loop Parameters
	int maxIterations = 100;
	int i,j;

	int M = 30;
	int N = 20;

	//Convergence Parameters
	fp D  = 10;
	fp U = 2;
	fp W = 1;
	fp A = 1;

	//Intermediary Loop Variables
	fp delta_z = 0;
    fp delta_l = 0;


	fp x = 0;
	fp y = 0;




	fp x_tmp = 0;
	fp y_tmp = 0;
	fp dl_tmp = 0;






	for (int k = 0; k < maxIterations; k++)
	{

//#pragma HLS pipeline II = 80

		//Compute Z_K+1

		for (i = 0; i < M; i++)
		{

#pragma HLS unroll
			delta_z = 0;
			x = 0;
			y = 0;

compute_x:for (j = 0; j < M; j++)
			{
				#pragma HLS unroll

				x_tmp = H[i][j] * z[j][0];

				x = x + x_tmp;
			}


compute_y:for (j = 0; j < N; j++)
			{
				#pragma HLS unroll
				y_tmp = (E[j][i] * lambda[j][0]);

				y = y + y_tmp;
			}

			delta_z = A * (((x - y) - f[i][0]) / D);


			//Projection Block

			if (z[i][0] - delta_z < z_min[i][0])
				z[i][0] = z_min[i][0];
			else if (z[i][0] - delta_z > z_max[i][0])
				z[i][0] = z_max[i][0];
			else
				z[i][0] = z[i][0] - delta_z;
		}

		//Compute Lambda_K+1

compute_l_outer:for (i = 0; i < N; i++)
		{

			delta_l = 0;


compute_l_inner:for (j = 0; j < M; j++)
			{
#pragma HLS unroll
				dl_tmp = E[i][j] * z[j][0];

				delta_l = delta_l + dl_tmp;
			}


			delta_l = W * (delta_l - e[i][0]) / U;

			lambda[i][0] = lambda[i][0] - delta_l;
		}

	}

	u_1 = z[0][0];
    u_2 = z[1][0];

    cout << "u1" << u_1 << "\n";
    cout << "u2" << u_2 << "\n";



}



